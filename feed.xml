<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="4.4.1">Jekyll</generator><link href="https://domenec-madrid.github.io/feed.xml" rel="self" type="application/atom+xml"/><link href="https://domenec-madrid.github.io/" rel="alternate" type="text/html" hreflang="en"/><updated>2026-02-17T17:20:10+00:00</updated><id>https://domenec-madrid.github.io/feed.xml</id><title type="html">blank</title><subtitle></subtitle><entry><title type="html">Covert-Nonce Channel Attacks on Bitcoin Hardware Wallets</title><link href="https://domenec-madrid.github.io/blog/2025/cvca/" rel="alternate" type="text/html" title="Covert-Nonce Channel Attacks on Bitcoin Hardware Wallets"/><published>2025-09-01T00:00:00+00:00</published><updated>2025-09-01T00:00:00+00:00</updated><id>https://domenec-madrid.github.io/blog/2025/cvca</id><content type="html" xml:base="https://domenec-madrid.github.io/blog/2025/cvca/"><![CDATA[<p>When we talk about self-custody and protecting our bitcoins, we understand that the seed used to generate our private keys must be completely isolated and stored securely. The best-known solutions on the market for solving this problem are hardware/cold wallets.</p> <p>These impenetrable fortresses seem perfect for this task. Isolated from the internet, protected by passwords to prevent unauthorized access, equipped with secure chips to resist physical attacks, and designed to prevent any kind of information leak. After all, the operations they perform are critical when it comes to cryptocurrency management.</p> <p>It seems impossible to attack these devices if access is completely restricted. But‚Ä¶ what if, just like Agamemnon‚Äôs army infiltrated Troy with the famous wooden horse, an attacker managed to gain access to the hardware wallet without the user‚Äôs knowledge?</p> <hr/> <h2 id="the-dark-skippy-case">The Dark Skippy case</h2> <p>A few years ago, Lloyd Fournier, Nick Farrow, and Robin Linus discovered a vulnerability affecting probabilistic signing devices that allows private keys to be ex-filtrated secretly through the signatures they generate. This discovery was named <a href="https://darkskippy.com/">Dark Skippy</a> and exploits the random value in the signature, which in principle should be generated deterministically (<a href="https://datatracker.ietf.org/doc/html/rfc6979">RFC 6979</a>), by embedding secret information known only to the attacker within the signature.</p> <p>The attack they demonstrated is a covert channel attack using the nonce of probabilistic signatures. By modifying the device‚Äôs firmware, it is possible to alter the way signatures are generated in order to produce a predictable ‚Äúrandom‚Äù value derived from a seed. When a transaction is made on a public network, e.g., the blockchain, the attacker can identify the transaction and, with some effort, recover the ex-filtrated critical data.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/cvca/dark-skippy-480.webp 480w,/assets/img/posts/cvca/dark-skippy-800.webp 800w,/assets/img/posts/cvca/dark-skippy-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/posts/cvca/dark-skippy.png" class="img-fluid w-75 d-block mx-auto rounded z-depth-1" width="100%" height="auto" alt="Dark Skippy covert channel attack" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 1. Dark Skippy ‚Äì attack schematic.</figcaption> </figure> <hr/> <h2 id="practical-example-supplychain-attack">Practical example: supply‚Äëchain attack</h2> <p>Some of you might be thinking, <em>‚ÄúDom√®nec, there‚Äôs an inconsistency here, you told us that hardware wallets are isolated, password‚Äëprotected and very secure; how could anyone modify the device firmware?‚Äù</em> You‚Äôre right, these attacks are genuinely difficult to carry out. Still, extremely sophisticated methods exist that can succeed.</p> <blockquote> <p><strong>For example, imagine a classic supply‚Äëchain attack:</strong> a factory produces thousands upon thousands of these devices. One day the company executives do the math and realise the value stored on their devices is worth several times the firm‚Äôs annual profit. They hear about these kinds of attacks and decide to go ahead. They modify the firmware, ship out malicious devices, and wait for months. Time passes and users begin making transactions meanwhile the ‚Äúattackers‚Äù monitor the blockchain. Gradually they recover seeds, and eventually they decide they have enough. Once they have the private keys they start moving users funds. At this point, Alice, who bought one of the company‚Äôs devices a few months earlier, checks her hot wallet<sup id="fnref:hotwallet"><a href="#fn:hotwallet" class="footnote" rel="footnote" role="doc-noteref">1</a></sup> and sees transactions she did not author, notices funds moving to unknown addresses, and discovers her wallet is completely empty. Naturally, she panics.</p> </blockquote> <p>As the previous example shows, Alice made only a couple of transactions with the compromised device and did not realise she‚Äôd been attacked until it was too late. That‚Äôs because these attacks are very hard to detect, the device continues to function correctly and produces signatures that look valid and secure to everyone except the attacker. Who, by dealing with the discrete‚Äëlog problem, can recover parts of the seed.</p> <hr/> <h2 id="a-proposed-solution-antiexfil">A proposed solution: Anti‚ÄëExfil</h2> <p>Not everything is hopeless. Andrew Poelstra and Jonas Nick proposed a <a href="https://medium.com/blockstream/anti-exfil-stopping-key-exfiltration-589f02facc2e">way to prevent the nonce generation from depending solely on the hardware wallet</a>. Their proposal prevents this class of attacks by sharing secrets between the hot wallet and the cold wallet. Concretely, the scheme forces both participants to commit to shared secrets so that the signature‚Äôs randomness is partly derived from those secrets. That way, when a transaction is signed the hot wallet can verify that the nonce was generated correctly, and the user can be confident the hardware wallet produced the value honestly at random.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/cvca/anti-exfil-480.webp 480w,/assets/img/posts/cvca/anti-exfil-800.webp 800w,/assets/img/posts/cvca/anti-exfil-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/posts/cvca/anti-exfil.png" class="img-fluid w-75 d-block mx-auto rounded z-depth-1" width="100%" height="auto" alt="Anti‚ÄëExfil protocol diagram" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 2. Diagram of the Anti‚ÄëExfil protocol.</figcaption> </figure> <p>Today this solution is implemented by the Jade and BitBox wallets. Each implements its own Anti‚ÄëExfil system, which unfortunately means the protocol can only be fully validated using the corresponding hot wallet provided by the same vendor.</p> <p>However, the solution has a usability problem. As shown in Figure 2, the protocol is a two‚Äëround exchange. In practice this is unnoticeable when the devices are physically connected by cable. Unfortunately, with air‚Äëgapped devices you have no choice but to perform the operations twice (usually via QR codes) to complete the protocol.</p> <p>Although effective, this approach is impractical for cable‚Äëfree devices. That leaves an open research question: is it possible to design a single‚Äëround protocol? The Discrypt group will continue researching and testing new ideas until we find a solution that is both practical and secure.</p> <p>Stay tuned, we might have some fresh news to share sooner rather than later!</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/cvca/office-480.webp 480w,/assets/img/posts/cvca/office-800.webp 800w,/assets/img/posts/cvca/office-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/posts/cvca/office.png" class="img-fluid w-75 d-block mx-auto rounded z-depth-1" width="100%" height="auto" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:hotwallet"> <p>A wallet connected to the internet. In the context we‚Äôre discussing, it should not store the seed.¬†<a href="#fnref:hotwallet" class="reversefootnote" role="doc-backlink">&#8617;</a></p> </li> </ol> </div>]]></content><author><name></name></author><category term="Bitcoin,"/><category term="Criptography,"/><category term="Hardware"/><category term="Wallets,"/><category term="Signatures"/><summary type="html"><![CDATA[When we talk about self-custody and protecting our bitcoins, we understand that the seed used to generate our private keys must be completely isolated and stored securely. The best-known solutions on the market for solving this problem are hardware/cold wallets.]]></summary></entry><entry><title type="html">Build Your Own Bitcoin Main-net</title><link href="https://domenec-madrid.github.io/blog/2025/byom/" rel="alternate" type="text/html" title="Build Your Own Bitcoin Main-net"/><published>2025-05-01T00:00:00+00:00</published><updated>2025-05-01T00:00:00+00:00</updated><id>https://domenec-madrid.github.io/blog/2025/byom</id><content type="html" xml:base="https://domenec-madrid.github.io/blog/2025/byom/"><![CDATA[<p>During my initial research period at UAB, I began developing a replica of the real Bitcoin mainnet. While this might sound unusual‚Äîespecially given the existence of testnet and regtest networks‚Äîthere‚Äôs a clear motivation behind it.</p> <p>Our research team needed a controlled environment to analyse <strong>wallet fingerprints</strong> for a further study on address clustering. Since many wallets offer limited or no support for testnet or regtest, we created a full-featured, <strong>isolated mainnet</strong> that behaves like the real Bitcoin network while remaining entirely under our control.</p> <p>The implemented network is built directly from the <strong>original Bitcoin Core source code</strong>, but it operates in complete isolation from Bitcoin‚Äôs public mainnet.</p> <hr/> <h2 id="why-build-your-own-mainnet">Why build your own mainnet?</h2> <p>Creating a private Bitcoin mainnet replica opens the door to capabilities that are otherwise impossible or impractical to achieve.</p> <h3 id="benefits"><strong>Benefits</strong></h3> <ul> <li><strong>Total control over the chain</strong> <ul> <li>Execute tests in a ‚Äúdistributed‚Äënature‚Äù environment without relying on real distributed infrastructure.</li> <li>Perform large‚Äëscale transaction testing.</li> </ul> </li> <li><strong>Easy deployment</strong>, since every node runs inside a Docker container.</li> <li><strong>Compatible with software and hardware that only operate in mainnet environments.</strong></li> <li><strong>Zero‚Äëcost transactions</strong>, enabling unlimited experimentation.</li> </ul> <hr/> <h2 id="requirements">Requirements</h2> <p>To ensure that the chain works exactly as expected, two constraints must be respected:</p> <ul> <li><strong>SegWit and Taproot must be enabled from the genesis block.</strong><br/> Their activation heights influence transaction validity; using these features before their expected height would cause nodes to reject the blocks.</li> <li><strong>The network must remain <em>fully isolated</em> from the internet</strong> to prevent accidental synchronization with the real Bitcoin blockchain.</li> </ul> <hr/> <h2 id="architecture">Architecture</h2> <p>We define the network with three critical node types:</p> <ul> <li><strong>Full Node</strong>: Ensures consensus on the chain.</li> <li><strong>Router Node</strong>: Manages peer connectivity.</li> <li><strong>Miner Node</strong>: Mines a block whenever a transaction is sent into the network.</li> </ul> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/byom/nodes-480.webp 480w,/assets/img/posts/byom/nodes-800.webp 800w,/assets/img/posts/byom/nodes-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/posts/byom/nodes.png" class="img-fluid w-50 d-block mx-auto rounded z-depth-1" width="100%" height="auto" alt="Node architecture diagram" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 1. Architecture of the node setup.</figcaption> </figure> <p>Each node is built into a custom <strong>Ubuntu-based Docker image containing Bitcoin Core 24.0.1</strong>, resulting in an image size of approximately <strong>5.11 GB</strong>.<br/> The associated <code class="language-plaintext highlighter-rouge">Dockerfile</code> clones Bitcoin Core, applies some modifications, compiles it, and configures the node for execution.</p> <h3 id="modified-bitcoin-core-files">Modified Bitcoin Core files</h3> <blockquote> <p>The two required modifications are:</p> <ul> <li><strong>chainparams.cpp</strong> ‚Äî SegWit and Taproot are activated at genesis.</li> <li><strong>mining.cpp</strong> ‚Äî Removes initial block validation checks to allow mining even when the node is not synchronized.</li> </ul> </blockquote> <p>An <strong>entrypoint script</strong> ensures the service starts with minimal permissions and only launches Docker if the <code class="language-plaintext highlighter-rouge">bitcoind</code> daemon is healthy.</p> <hr/> <h2 id="configuring-bitcoinconf">Configuring <code class="language-plaintext highlighter-rouge">bitcoin.conf</code></h2> <p>The <code class="language-plaintext highlighter-rouge">bitcoin.conf</code> file defines how each Bitcoin node behaves within the replica network.</p> <p>To achieve the expected behavior, you should configure at least:</p> <ul> <li><strong>rpcallowip</strong> ‚Äî Restrict RPC access to the Docker network or a specific IP.</li> <li><strong>paytxfee</strong> ‚Äî Set a static fee (e.g., <code class="language-plaintext highlighter-rouge">0.0001</code>) since fee estimation will fail on an empty chain.</li> <li><strong>minimumchainwork = 0</strong> ‚Äî As the network starts fully fresh.</li> <li><strong>txindex = 1</strong> ‚Äî Optional, but useful for exploring transactions.</li> </ul> <blockquote> <p>üí≠ You can experiment with <code class="language-plaintext highlighter-rouge">bitcoin.conf</code> settings <a href="https://jlopp.github.io/bitcoin-core-config-generator/">here :)</a></p> </blockquote> <hr/> <h2 id="network-setup">Network setup</h2> <p>Each node is deployed inside a <strong>Docker network</strong>, ensuring full isolation from external peers.<br/> Connections between nodes rely on <a href="https://developer.bitcoin.org/reference/rpc/addnode.html"><code class="language-plaintext highlighter-rouge">addnode</code></a>, linking all peers through the router node.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/byom/network-480.webp 480w,/assets/img/posts/byom/network-800.webp 800w,/assets/img/posts/byom/network-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/posts/byom/network.png" class="img-fluid w-75 d-block mx-auto rounded z-depth-1" width="100%" height="auto" alt="Network architecture" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 2. Network configuration for the main-net replica.</figcaption> </figure> <p>You can connect external software wallets using RPC, but <strong>only from allowed endpoints</strong>.</p> <hr/> <h2 id="mining">Mining</h2> <p>Mining can be done through simple scripts. Given the network‚Äôs difficulty of <strong>1</strong>, block discovery is almost instantaneous.</p> <p>Although a basic Python mining script is available in the repository, we replaced it with a compact little <a href="https://bitaxe.org/"><strong>ASIC miner</strong></a> for more realistic testing.</p> <hr/> <h2 id="add-ons">Add-ons</h2> <p>Just like in the real Bitcoin network, additional services can be integrated.</p> <h3 id="faucet">Faucet</h3> <p>We implemented a lightweight server running to distribute free coins for testing.</p> <h3 id="block-explorer">Block Explorer</h3> <p>A local Dockerized deployment of <strong>Mempool Space</strong> provides full visibility into blocks and transactions.</p> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/posts/byom/block_explorer-480.webp 480w,/assets/img/posts/byom/block_explorer-800.webp 800w,/assets/img/posts/byom/block_explorer-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="/assets/img/posts/byom/block_explorer.png" class="img-fluid w-75 d-block mx-auto rounded z-depth-1" width="100%" height="auto" alt="Mempool Space local deployment" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> <figcaption class="caption">Figure 3. Local Mempool Space instance.</figcaption> </figure> <hr/> <h2 id="installation-guide">Installation guide</h2> <p>Alright, the real fun begins now. How do we build it and actually use it? You‚Äôve got a detailed guide over on the GitHub README, but let me break it down for you here.</p> <h3 id="prerequisites">Prerequisites</h3> <p>You‚Äôll need Docker (v20.10 or higher recommended) installed on your system.</p> <h3 id="method-1-download-the-image-from-github-container-registry">Method 1: Download the image from GitHub Container Registry</h3> <p>You can directly pull the pre-built Docker image and run the setup script without building the image from source following these steps:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Pull the image from the GitHub Container Registry</span>
docker pull ghcr.io/dmenec/mainnet_testbed:1.0

<span class="c"># Clone the repository </span>
git clone https://github.com/Dmenec/BTC-Labnet.git
<span class="nb">cd </span>BTC-Labnet

<span class="c"># Run the script to set up Docker containers</span>
./start.sh
</code></pre></div></div> <h3 id="method-2-build-from-source">Method 2: Build from source</h3> <p>Follow these steps to build the image from source:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Clone the repository</span>
git clone https://github.com/Dmenec/BTC-Labnet.git
<span class="nb">cd </span>BTC-Labnet

<span class="c"># Run the script to set up Docker containers</span>
./start.sh
</code></pre></div></div> <p>After execution, three interconnected Bitcoin nodes (bc-node1, bc-node2, and bc-node3) will be created.</p> <hr/> <h2 id="setup-process-details">Setup process details</h2> <h3 id="building-a-customized-docker-image-for-bitcoin-core">Building a customized Docker image for Bitcoin Core</h3> <p>First, modify Bitcoin Core to adjust the code and enable SegWit and Taproot. Then, create a Dockerfile using your own configuration to build your custom Bitcoin Core image. Finally, build the Docker image by running:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker build <span class="nt">-t</span> bitcoin <span class="nb">.</span>
</code></pre></div></div> <h3 id="setting-up-the-docker-network">Setting up the Docker network</h3> <p>Create a Docker bridge network to isolate your Bitcoin nodes:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker network create <span class="nt">-d</span> bridge bitcoin_network
</code></pre></div></div> <h3 id="running-bitcoin-nodes">Running Bitcoin nodes</h3> <p>Start your Bitcoin node with the following command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run <span class="nt">-it</span> <span class="nt">-d</span> <span class="nt">--network</span> bitcoin_network <span class="nt">--name</span> bc-node1 <span class="nt">-p</span> 8333:8333 <span class="nt">-p</span> 8332:8332 bitcoin <span class="nt">-printtoconsole</span> <span class="nt">-txindex</span><span class="o">=</span>1 <span class="nt">-reindex</span>
</code></pre></div></div> <hr/> <p>As you can see, installing it isn‚Äôt too complicated. While the build does compile Bitcoin Core, so it might take a few minutes, once it‚Äôs done‚Ä¶ you‚Äôll have all the power to do whatever you want with your Bitcoin blockchain clone!</p> <figure> <picture> <source class="responsive-img-srcset" srcset="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExa3ZqbXIwMDV3cmRybWtqNnVqdDFxOHZyY2JwNHYwbHI1NGI3M2ZjZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l36kU80xPf0ojG0Erg/giphy-480.webp 480w,https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExa3ZqbXIwMDV3cmRybWtqNnVqdDFxOHZyY2JwNHYwbHI1NGI3M2ZjZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l36kU80xPf0ojG0Erg/giphy-800.webp 800w,https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExa3ZqbXIwMDV3cmRybWtqNnVqdDFxOHZyY2JwNHYwbHI1NGI3M2ZjZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l36kU80xPf0ojG0Erg/giphy-1400.webp 1400w," type="image/webp" sizes="95vw"/> <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExa3ZqbXIwMDV3cmRybWtqNnVqdDFxOHZyY2JwNHYwbHI1NGI3M2ZjZCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l36kU80xPf0ojG0Erg/giphy.gif" class="img-fluid w-75 d-block mx-auto rounded z-depth-1" width="100%" height="auto" alt="With great power" data-zoomable="" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"/> </picture> </figure>]]></content><author><name></name></author><category term="Bitcoin,"/><category term="Docker,"/><category term="Testing,"/><category term="Core,"/><category term="DevOps"/><summary type="html"><![CDATA[During my initial research period at UAB, I began developing a replica of the real Bitcoin mainnet. While this might sound unusual‚Äîespecially given the existence of testnet and regtest networks‚Äîthere‚Äôs a clear motivation behind it.]]></summary></entry></feed>